(function(){"use strict";var e={7919:function(e,t,n){var a=n(9242),s=n(3396);function r(e,t){const n=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(n)}var i=n(89);const o={},l=(0,i.Z)(o,[["render",r]]);var u=l,c=n(2483);const d=e=>((0,s.dD)("data-v-14d37914"),e=e(),(0,s.Cn)(),e),p={class:"message-chat"},m={key:1,class:"login_msg"},g=d((()=>(0,s._)("a",{href:"#"},"Inicia sesión",-1)));function y(e,t,n,a,r,i){const o=(0,s.up)("loading"),l=(0,s.up)("create-user-modal"),u=(0,s.up)("MainMenu"),c=(0,s.up)("chat-componet");return(0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(o,{loading:e.loading},null,8,["loading"]),(0,s.Wm)(l,{visible:e.createDialog,onClose:t[0]||(t[0]=t=>e.createDialog=!1),onCreateUser:e.createUser},null,8,["visible","onCreateUser"]),(0,s.Wm)(u,{loggedIn:e.getIsLoggedIn,connected:e.getIsConnected,user:e.getLoginUser,onCreateUser:e.openCreateUser,onConnectWallet:e.connectAndLogin},null,8,["loggedIn","connected","user","onCreateUser","onConnectWallet"]),e.getIsConnected?((0,s.wg)(),(0,s.j4)(c,{key:0,loggedIn:e.getIsLoggedIn,messagesList:e.messages,onOnSendMessage:e.sendMessage},null,8,["loggedIn","messagesList","onOnSendMessage"])):((0,s.wg)(),(0,s.iD)("div",m,[g,(0,s.Uk)(" con metamask para ver los mensajes ")]))])}var h=n(7139);function f(e,t,n,a,r,i){const o=(0,s.up)("el-menu-item"),l=(0,s.up)("el-menu"),u=(0,s.up)("el-header");return(0,s.wg)(),(0,s.j4)(u,{class:"navbar"},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{mode:"horizontal","active-text-color":"#409EFF"},{default:(0,s.w5)((()=>[e.connected?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(o,{key:0,onClick:e.connectWallet},{default:(0,s.w5)((()=>[(0,s.Uk)("Conectar")])),_:1},8,["onClick"])),(0,s.Wm)(o,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Chat")])),_:1}),!e.loggedIn&&e.connected?((0,s.wg)(),(0,s.j4)(o,{key:1,onClick:e.createUser},{default:(0,s.w5)((()=>[(0,s.Uk)("Crear usuario")])),_:1},8,["onClick"])):(0,s.kq)("",!0),e.loggedIn?((0,s.wg)(),(0,s.j4)(o,{key:2},{default:(0,s.w5)((()=>[(0,s.Uk)((0,h.zw)(`Hola ${e.user.name}`),1)])),_:1})):(0,s.kq)("",!0),e.loggedIn?((0,s.wg)(),(0,s.j4)(o,{key:3},{default:(0,s.w5)((()=>[(0,s.Uk)(" Actualizar ")])),_:1})):(0,s.kq)("",!0)])),_:1})])),_:1})}var w=(0,s.aZ)({data(){return{createDialog:!1}},props:{connected:{type:Boolean},loggedIn:{type:Boolean},user:{type:Object,default:()=>({})}},methods:{connectWallet(){this.$emit("connectWallet")},createUser(){this.$emit("createUser")}}});const v=(0,i.Z)(w,[["render",f],["__scopeId","data-v-6e4f7358"]]);var b=v;const M={class:"chat-message-content"},T={class:"chat-message-header"},U={class:"chat-message-user"},C={class:"chat-message-time"},_={class:"chat-message-text"};function k(e,t,n,r,i,o){const l=(0,s.up)("el-card"),u=(0,s.up)("el-main"),c=(0,s.up)("el-input"),d=(0,s.up)("el-tooltip"),p=(0,s.up)("el-button"),m=(0,s.up)("el-footer");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(u,{class:"chat-container"},{default:(0,s.w5)((()=>[e.messagesList.length?((0,s.wg)(),(0,s.j4)(l,{key:0,class:"chat-card"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.messagesList,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.id,class:(0,h.C_)(["chat-message",e.isMe?"chat-message-me":""])},[(0,s._)("div",M,[(0,s._)("div",T,[(0,s._)("span",U,(0,h.zw)(e.user),1),(0,s._)("span",C,(0,h.zw)(e.time),1)]),(0,s._)("div",_,(0,h.zw)(e.text),1)])],2)))),128))])),_:1})):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(m,{class:"chat-footer"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{disabled:e.loggedIn,content:"Inicia sesión para escribir mensajes"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{modelValue:e.newMessage,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newMessage=t),placeholder:"Escribe un mensaje...",clearable:"",class:"chat-input",style:{flex:"1"},onKeyup:(0,a.D2)(e.sendMessage,["enter"]),disabled:!e.loggedIn},null,8,["modelValue","onKeyup","disabled"])])),_:1},8,["disabled"]),(0,s.Wm)(p,{type:"primary",onClick:e.sendMessage},{default:(0,s.w5)((()=>[(0,s.Uk)("Enviar")])),_:1},8,["onClick"])])),_:1})],64)}var I=(0,s.aZ)({components:{},data(){return{newMessage:""}},props:{loggedIn:{type:Boolean},messagesList:{type:Array,default:()=>[]}},methods:{sendMessage(){""!==this.newMessage.trim()&&this.$emit("onSendMessage",this.newMessage)}}});const W=(0,i.Z)(I,[["render",k],["__scopeId","data-v-e143a5d2"]]);var D=W,x=n.p+"img/loading.2e182055.gif";const L=e=>((0,s.dD)("data-v-a9a947da"),e=e(),(0,s.Cn)(),e),j={key:0,class:"loading-indicator"},O=L((()=>(0,s._)("img",{src:x,alt:"Cargando...",class:"loading_img"},null,-1))),P=[O];function Z(e,t,n,a,r,i){return n.loading?((0,s.wg)(),(0,s.iD)("div",j,P)):(0,s.kq)("",!0)}var A=n(504),V={data(){return{icons:A.ciZ}},props:{loading:{type:Boolean,default:!1}}};const $=(0,i.Z)(V,[["render",Z],["__scopeId","data-v-a9a947da"]]);var E=$;const z=e=>((0,s.dD)("data-v-60a28708"),e=e(),(0,s.Cn)(),e),B={class:"modal-content"},q=z((()=>(0,s._)("p",{class:"explanation"},[(0,s.Uk)("Coste: "),(0,s._)("b",null,"0.01 ETH.")],-1)));function H(e,t,n,a,r,i){const o=(0,s.up)("el-input"),l=(0,s.up)("el-button"),u=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(u,{modelValue:e.getIsVisible,"onUpdate:modelValue":t[1]||(t[1]=t=>e.getIsVisible=t),title:"Crear Usuario",class:"custom-dialog"},{default:(0,s.w5)((()=>[(0,s._)("div",B,[(0,s.Wm)(o,{modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=t=>e.username=t),placeholder:"Ingrese su nombre de usuario"},null,8,["modelValue"]),q,(0,s.Wm)(l,{type:"primary",onClick:e.createUser},{default:(0,s.w5)((()=>[(0,s.Uk)("Crear")])),_:1},8,["onClick"])])])),_:1},8,["modelValue"])}var F=(0,s.aZ)({props:{visible:{type:Boolean}},data(){return{username:""}},computed:{getIsVisible(){return this.visible}},methods:{createUser(){this.$emit("createUser",this.username)}}});const S=(0,i.Z)(F,[["render",H],["__scopeId","data-v-60a28708"]]);var K=S,N=n(1832),Y=n.n(N);const J=async e=>{let t="";try{const n=await e.eth.getAccounts();return n.length>0?(t=n[0],t):t}catch(n){throw console.error("Error al obtener la dirección de la cuenta:",n),n}};async function R(){return new Promise((e=>{if("undefined"!==typeof window.ethereum)try{const t=new(Y())(window.ethereum);window.ethereum.enable().then((()=>{e(t)})).catch((()=>{e(void 0)}))}catch(t){e(void 0)}else e(void 0)}))}async function G(){let e=!1;if("undefined"!==typeof window.ethereum){const t=await window.ethereum.request({method:"eth_accounts"});return t.length>0&&(e=!0),e}return e}async function Q(e,t,n){return new Promise((a=>{e.eth.sendTransaction(t).on("transactionHash",(e=>{n(),console.log("Transaction hash:",e)})).on("receipt",(()=>a(!0))).on("error",(e=>{console.error("Create user error",e),a(!1)}))}))}var X=JSON.parse('{"Mt":[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BalanceWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"MessageDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"content","type":"string"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"MessageSent","type":"event"},{"anonymous":false,"inputs":[{"components":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"content","type":"string"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"bool","name":"isDeleted","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct MessageModel","name":"message","type":"tuple"},{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"address","name":"wallet","type":"address"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct UserModel","name":"user","type":"tuple"}],"indexed":false,"internalType":"struct MessageUserModel[]","name":"","type":"tuple[]"}],"name":"UnreadUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"string","name":"name","type":"string"}],"name":"UserCreated","type":"event"},{"inputs":[{"internalType":"string","name":"name","type":"string"}],"name":"createUser","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"deleteMessage","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"disableUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"fee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllMessages","outputs":[{"components":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"content","type":"string"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"bool","name":"isDeleted","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct MessageModel","name":"message","type":"tuple"},{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"address","name":"wallet","type":"address"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct UserModel","name":"user","type":"tuple"}],"internalType":"struct MessageUserModel[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUser","outputs":[{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"address","name":"wallet","type":"address"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct UserModel","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getUserUnreadMessageCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getUserUnreadMessages","outputs":[{"components":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"content","type":"string"},{"internalType":"address","name":"sender","type":"address"},{"internalType":"bool","name":"isDeleted","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct MessageModel","name":"message","type":"tuple"},{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"address","name":"wallet","type":"address"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"created","type":"uint256"}],"internalType":"struct UserModel","name":"user","type":"tuple"}],"internalType":"struct MessageUserModel[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"setFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"totalActiveMessages","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"updateUserMessageAsReadAndEmit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"name","type":"string"}],"name":"updateUserName","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"withdrawBalance","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"content","type":"string"}],"name":"writeMessage","outputs":[],"stateMutability":"nonpayable","type":"function"}]}');const ee=(e,t)=>t.map((t=>({id:Number(t.message.id),user:t.user.name,text:t.message.content,time:t.message.created,isMe:e===t.user.wallet})));var te;(function(e){e["publicMessagingETHTest"]="0x36db5531fcef02be32105213b02286c26eda6c10"})(te||(te={}));const ne=te.publicMessagingETHTest;async function ae(e,t){const n=X.Mt,a=new t.eth.Contract(n,ne);return new Promise(((t,n)=>{a.methods.getAllMessages().call().then((n=>{const a=ee(e,n);t(a)})).catch((e=>{n(e)}))}))}async function se(e,t){const n=X.Mt,a=new t.eth.Contract(n,ne);return new Promise((t=>{a.methods.getUser(e).call().then((e=>{t(e)})).catch((e=>{console.error("get user error",e),t(void 0)}))}))}async function re(e,t,n,a){const s=X.Mt,r=new t.eth.Contract(s,ne),i=t.utils.toWei("0.01","ether"),o={from:n,to:ne,value:i,data:r.methods.createUser(e).encodeABI()};return Q(t,o,a)}const ie=(0,s.aZ)({data(){return{store:this.$store}},methods:{getUser(){return this.store?.state?.user},setUser(e){this.store?.commit("setUser",e)},isLoggedIn(){return this.store?.state?.loggedIn},setIsLoggedIn(e){this.store?.commit("setLoggedIn",e)},async checkMetamaskConnected(){let e=!1;return e=this.store?.state?.connected,e||(e=await G()),e},isConnected(){return this.store?.state?.connected},getWallet(){return this.store?.state?.wallet},getProvider(){return this.store?.state?.provider},async connectToMetamask(){const e=await R();if(e){const t=await J(e);this.store?.commit("setConnected",!0),this.store?.commit("setProvider",e),this.store?.commit("setUserWallet",t)}}}});var oe=ie,le=n(7178),ue=(0,s.aZ)({components:{CreateUserModal:K,MainMenu:b,"chat-componet":D,loading:E},mixins:[oe],data(){return{createDialog:!1,userWallet:"",messages:[],loading:!1}},computed:{getIsConnected(){return this.isConnected()},getIsLoggedIn(){return this.isLoggedIn()},getLoginUser(){return this.getUser()}},async mounted(){const e=await this.checkMetamaskConnected();e&&await this.connectAndLogin()},methods:{closeCreateUser(){this.createDialog=!1,this.$forceUpdate()},openCreateUser(){this.createDialog=!0,this.$forceUpdate()},async createUser(e){console.log("createuser",e,this.getProvider());const t=await re(e,this.getProvider(),this.getWallet(),this.onConfirmCreate);this.loading=!1,console.log("created",t),t&&this.onCreateUser(e)},async connectAndLogin(){await this.connectToMetamask(),await this.getMessagesData(),this.$forceUpdate();const e=await se(this.getWallet(),this.getProvider());this.setIsLoggedIn(!!e),e&&this.setUser(e)},async getMessagesData(){const e=await ae(this.getWallet(),this.getProvider());this.messages=e},async sendMessage(){},onConfirmCreate(){(0,le.z8)({showClose:!0,message:"Creando Usuario",type:"warning"}),this.loading=!0,this.closeCreateUser()},async onCreateUser(e){this.createDialog=!1,(0,le.z8)({showClose:!0,message:`Usuario ${e} creado!`,type:"success"}),await this.connectAndLogin(),this.$forceUpdate()}}});const ce=(0,i.Z)(ue,[["render",y],["__scopeId","data-v-14d37914"]]);var de=ce;const pe=[{path:"/",name:"home",component:de}],me=(0,c.p7)({history:(0,c.r5)(),routes:pe});var ge=me,ye=n(4252),he=n(65),fe=(0,he.MT)({state:{loggedIn:!1,connected:!1,provider:void 0,wallet:"",user:void 0},mutations:{setLoggedIn(e,t){e.loggedIn=t},setConnected(e,t){e.connected=t},setProvider(e,t){e.provider=t},setUserWallet(e,t){e.wallet=t},setUser(e,t){e.user=t}}});(0,a.ri)(u).use(fe).use(ye.Z).use(A.ZPm).use(ge).mount("#app")}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,a,s,r){if(!a){var i=1/0;for(c=0;c<e.length;c++){a=e[c][0],s=e[c][1],r=e[c][2];for(var o=!0,l=0;l<a.length;l++)(!1&r||i>=r)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(o=!1,r<i&&(i=r));if(o){e.splice(c--,1);var u=s();void 0!==u&&(t=u)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[a,s,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.p="/"}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,r,i=a[0],o=a[1],l=a[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)var c=l(n)}for(t&&t(a);u<i.length;u++)r=i[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(c)},a=self["webpackChunkethereum_messaging_app_front"]=self["webpackChunkethereum_messaging_app_front"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(7919)}));a=n.O(a)})();
//# sourceMappingURL=app.69b49a4f.js.map